<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Day 1 - The Eternal Scroll</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@300;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #121212; 
            font-family: 'Quicksand', sans-serif;
            touch-action: none;
        }

        #canvas-container { 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 100%; 
            z-index: 1; 
        }
        
        #ui-layer {
            position: absolute;
            top: 0; left: 0; 
            width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* Fixed: Text container is now constrained to the scroll width */
        #letter-container {
            width: 75%; 
            max-width: 280px; 
            text-align: center;
            color: #3e2723; 
            opacity: 0;
            transform: translateY(30px);
            transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
        }

        h1 { 
            font-family: 'Dancing Script', cursive; 
            font-size: clamp(1.8rem, 8vw, 2.5rem); 
            margin-bottom: 10px; 
        }

        p { 
            font-size: clamp(0.85rem, 4vw, 1.1rem); 
            line-height: 1.5; 
            font-weight: 600; 
        }

        .hint {
            position: absolute;
            bottom: 8%;
            color: #ffd1d1;
            letter-spacing: 4px;
            font-size: 0.75rem;
            text-transform: uppercase;
            text-shadow: 0 0 15px rgba(255,182,193,0.6);
            font-weight: 600;
        }

        .back-btn {
            position: absolute;
            bottom: 14%;
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            opacity: 0;
            transition: 0.4s;
        }
        
        .back-btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div id="canvas-container"></div>
<div id="ui-layer">
    <div id="letter-container">
        <h1>For My Princess</h1>
        <p>
            You are the sun in my sky and the light in my life. This scroll is just the start of 7 days of surprises for the girl who deserves the world. 
            <br><br>
            I love you.
        </p>
    </div>
    <div class="hint" id="hint">Tap to Unroll</div>
    <a href="index.html" class="back-btn" id="backBtn">Return Home</a>
</div>

<script>
    let scene, camera, renderer, scrollGroup, paper, particles;
    let isOpened = false;

    function init() {
        scene = new THREE.Scene();
        
        const w = window.innerWidth;
        const h = window.innerHeight;
        const isMobile = w < 600;

        // Camera optimized for vertical mobile screens
        camera = new THREE.PerspectiveCamera(isMobile ? 75 : 45, w / h, 0.1, 1000);
        camera.position.z = isMobile ? 12 : 12;

        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(w, h);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 3));
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- BACKGROUND PARTICLES ---
        const pGeo = new THREE.BufferGeometry();
        const pCount = 1500;
        const pos = new Float32Array(pCount * 3);
        for(let i=0; i<pCount*3; i++) pos[i] = (Math.random() - 0.5) * 50;
        pGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        particles = new THREE.Points(pGeo, new THREE.PointsMaterial({ size: 0.05, color: 0xffb6c1, transparent: true, opacity: 0.6 }));
        scene.add(particles);

        // --- THE VERTICAL SCROLL ---
        scrollGroup = new THREE.Group();
        scrollGroup.rotation.z = Math.PI / 2; // Vertical rotation

        // Paper Mesh
        const paperGeo = new THREE.PlaneGeometry(6, 1, 32, 1);
        const paperMat = new THREE.MeshStandardMaterial({ color: 0xfff3e0, side: THREE.DoubleSide, roughness: 1 });
        paper = new THREE.Mesh(paperGeo, paperMat);
        paper.scale.y = 0.1; 
        scrollGroup.add(paper);

        function createPremiumRoller(yPos) {
            const group = new THREE.Group();
            const shaftGeo = new THREE.CylinderGeometry(0.18, 0.18, 6.5, 32);
            const woodMat = new THREE.MeshStandardMaterial({ color: 0x2d1b0e });
            const shaft = new THREE.Mesh(shaftGeo, woodMat);
            shaft.rotation.z = Math.PI / 2;
            
            const capGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.4, 32);
            const goldMat = new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.9, roughness: 0.1 });
            const capL = new THREE.Mesh(capGeo, goldMat);
            capL.rotation.z = Math.PI / 2;
            capL.position.x = -3.3;
            const capR = capL.clone();
            capR.position.x = 3.3;
            
            group.add(shaft, capL, capR);
            group.position.y = yPos;
            return group;
        }

        const topRoller = createPremiumRoller(0.05);
        const bottomRoller = createPremiumRoller(-0.05);
        scrollGroup.add(topRoller, bottomRoller);
        scene.add(scrollGroup);

        scene.add(new THREE.AmbientLight(0xffffff, 1));
        const spot = new THREE.DirectionalLight(0xffffff, 0.5);
        spot.position.set(0, 10, 10);
        scene.add(spot);

        animate();
    }

    function unroll() {
        if (isOpened) return;
        isOpened = true;

        gsap.to("#hint", { opacity: 0, duration: 0.5 });

        const rollers = scrollGroup.children.filter(c => c.type === "Group");
        
        // Unroll logic: Full screen height scaling
        const unrollHeight = window.innerHeight < 900 ? 12 : 14;

        gsap.to(rollers[0].position, { y: unrollHeight/2, duration: 2.5, ease: "expo.inOut" });
        gsap.to(rollers[1].position, { y: -unrollHeight/2, duration: 2.5, ease: "expo.inOut" });
        gsap.to(paper.scale, { y: unrollHeight, duration: 2.5, ease: "expo.inOut" });

        setTimeout(() => {
            const container = document.getElementById('letter-container');
            container.style.opacity = "1";
            container.style.transform = "translateY(0)";
            gsap.to("#backBtn", { opacity: 1, duration: 1 });
        }, 1500);
    }

    function animate() {
        requestAnimationFrame(animate);
        particles.rotation.y += 0.001;
        if (!isOpened) {
            scrollGroup.position.y = Math.sin(Date.now() * 0.002) * 0.2;
            scrollGroup.rotation.y = Math.sin(Date.now() * 0.001) * 0.1;
        }
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        renderer.setSize(w, h);
        camera.aspect = w / h;
        camera.fov = w < 600 ? 75 : 45;
        camera.updateProjectionMatrix();
    });

    window.addEventListener('touchstart', unroll, {passive: true});
    window.addEventListener('mousedown', unroll);

    init();
</script>
</body>
</html>